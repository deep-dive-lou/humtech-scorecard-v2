# n8n Nodes — CURRENT STATE (Baseline for Diffing)

IMPORTANT:
- This file represents the CURRENT LIVE n8n implementation.
- DO NOT edit this file to make changes.
- This file exists so an AI (Claude) can compare:
  - Desired state (new assessment copy + q_ids)
  - Against this current state
  - And output an explicit list of required changes.

---

## NODE: Question Scoring / pillar weight

```js
/**
 * HumTech Score Assessment – FINAL LOCKED VERSION
 *
 * Inputs:
 *   $json.rawAnswers -> { qid: "A" | "B" | "C" | "D" | "E" | "F" }
 *
 * Outputs:
 *   scoring.radar    -> 5 pillars (0–10)
 *   scoring.pillars  -> same values
 *   scoring.overall  -> score10, percent, maturityBand
 *   scoring.informative -> Q12–Q15 (unscored)
 */

// ---------------------------
// Inputs
// ---------------------------
const raw = $json.rawAnswers || {};

// ---------------------------
// 1) Question scoring (Q1–Q11 only, 0–5)
// ---------------------------
const SCORE_0_TO_5 = {
  "q1-engagement":           { A: 5, B: 4, C: 2, D: 3, E: 0 },
  "q2-response-time":        { A: 5, B: 4, C: 3, D: 2, E: 0 },
  "q3-availability":         { A: 5, B: 0, C: 0, D: 0, E: 0 },
  "q4-show-rate":            { A: 5, B: 4, C: 3, D: 2, E: 0 },

  "q5-transaction-rate":     { A: 5, B: 4, C: 4, D: 3, E: 2, F: 0 },
  "q6-primary-role":         { A: 5, B: 4, C: 4, D: 3, E: 2, F: 0 },

  "q7-follow-up-time":       { A: 5, B: 4, C: 3, D: 2, E: 0 },
  "q8-repetitive-tasks":      { A: 5, B: 4, C: 3, D: 2, E: 0 },
  "q9-kpi-tracking":          { A: 5, B: 3, C: 0, D: 0, E: 0 },
  "q10-documents":            { A: 5, B: 4, C: 0, D: 0, E: 0 },
  "q11-overall-automation":   { A: 5, B: 3, C: 1, D: 0, E: 0 }
};

// ---------------------------
// 2) Final pillars (radar axes)
// ---------------------------
const PILLARS = [
  "leadEngagementSpeed",
  "appointmentReliabilityConversion",
  "operationalFocusTimeEfficiency",
  "systemsAutomationMaturity",
  "revenueProtectionLeakageControl"
];

// ---------------------------
// 3) Question → pillar weights (LOCKED)
// ---------------------------
const QUESTION_WEIGHTS = {
  "q1-engagement": {
    leadEngagementSpeed: 0.6,
    revenueProtectionLeakageControl: 0.4
  },
  "q2-response-time": {
    leadEngagementSpeed: 0.7,
    revenueProtectionLeakageControl: 0.3
  },
  "q3-availability": {
    leadEngagementSpeed: 0.4,
    systemsAutomationMaturity: 0.6
  },
  "q4-show-rate": {
    appointmentReliabilityConversion: 0.6,
    revenueProtectionLeakageControl: 0.4
  },
  "q5-transaction-rate": {
    appointmentReliabilityConversion: 0.5,
    revenueProtectionLeakageControl: 0.5
  },
  "q6-primary-role": {
    operationalFocusTimeEfficiency: 1.0
  },
  "q7-follow-up-time": {
    operationalFocusTimeEfficiency: 0.6,
    revenueProtectionLeakageControl: 0.4
  },
  "q8-repetitive-tasks": {
    operationalFocusTimeEfficiency: 0.7,
    systemsAutomationMaturity: 0.3
  },
  "q9-kpi-tracking": {
    systemsAutomationMaturity: 0.7,
    appointmentReliabilityConversion: 0.3
  },
  "q10-documents": {
    systemsAutomationMaturity: 0.7,
    operationalFocusTimeEfficiency: 0.3
  },
  "q11-overall-automation": {
    systemsAutomationMaturity: 0.6,
    revenueProtectionLeakageControl: 0.4
  }
};

// ---------------------------
// Helpers
// ---------------------------
function scoreQuestion0to5(qid, answerId) {
  const map = SCORE_0_TO_5[qid];
  if (!map) return 0;
  const s = map[answerId];
  return typeof s === "number" ? s : 0;
}

function to0to10(score0to5) {
  return (score0to5 / 5) * 10;
}

function clamp0to10(v) {
  return Math.max(0, Math.min(10, v));
}

// ---------------------------
// 4) Compute pillar scores
// ---------------------------
const pillarTotals = Object.fromEntries(PILLARS.map(p => [p, 0]));
const pillarWeights = Object.fromEntries(PILLARS.map(p => [p, 0]));

const expectedQids = Object.keys(QUESTION_WEIGHTS);
const missingQuestions = [];

for (const qid of expectedQids) {
  const ans = raw[qid];
  if (!ans) missingQuestions.push(qid);

  const s0to5 = scoreQuestion0to5(qid, ans);
  const s0to10 = to0to10(s0to5);

  const weights = QUESTION_WEIGHTS[qid];
  for (const [pillar, w] of Object.entries(weights)) {
    pillarTotals[pillar] += s0to10 * w;
    pillarWeights[pillar] += w;
  }
}

const pillars = {};
for (const pillar of PILLARS) {
  const denom = pillarWeights[pillar] || 0;
  const rawScore = denom ? pillarTotals[pillar] / denom : 0;
  pillars[pillar] = clamp0to10(Math.round(rawScore * 10) / 10);
}

const radar = { ...pillars };

// ---------------------------
// 5) Overall score (average of pillars, weighted by pillar importance)
// ---------------------------
const PILLAR_IMPORTANCE = {
  leadEngagementSpeed: 0.22,
  appointmentReliabilityConversion: 0.22,
  operationalFocusTimeEfficiency: 0.22,
  systemsAutomationMaturity: 0.22,
  revenueProtectionLeakageControl: 0.12
};

let overallNumerator = 0;
let overallDenom = 0;
for (const p of PILLARS) {
  const w = PILLAR_IMPORTANCE[p] || 0;
  overallNumerator += (pillars[p] || 0) * w;
  overallDenom += w;
}
const overallScore10 = overallDenom ? overallNumerator / overallDenom : 0;
const overallScore10Rounded = clamp0to10(Math.round(overallScore10 * 10) / 10);
const overallPercent = Math.round((overallScore10Rounded / 10) * 100);

// Bands
function bandFor(score10) {
  if (score10 < 5.0) return "Constrained";
  if (score10 < 7.0) return "Emerging";
  if (score10 < 9.0) return "Developing/Advanced";
  return "Optimised";
}
const maturityBand = bandFor(overallScore10Rounded);

// ---------------------------
// 6) Debug/QA (optional)
// ---------------------------
const qa = {
  missingQuestions,
  expectedQids
};

// ---------------------------
// 7) Informative-only answers (Q12–Q15)
// ---------------------------
const informative = {
  q12DesiredOutcome: raw["q12-desired-outcome"] || null,

  q13Barriers: (() => {
    const v = raw["q13-barriers"];
    if (Array.isArray(v)) return v;
    if (typeof v === "string" && v) return [v];
    return null;
  })(),

  q14SolutionType: raw["q14-solution-type"] || null,
  q15Notes: raw["q15-notes"] || null
};

// ---------------------------
// 8) Return
// ---------------------------
return [
  {
    json: {
      ...$json,
      scoring: {
        radar,
        pillars,
        overall: {
          score10: overallScore10Rounded,
          percent: overallPercent,
          maturityBand
        },
        informative,
        qa
      }
    }
  }
];

## NODE: BANDING / QUAL MAPPING

Logs
Back to canvas


Input

Question Scoring / pillar weight
1 item
headers
connection
upgrade
host
n8n.resg.uk
x-real-ip
86.164.36.212
x-forwarded-for
86.164.36.212
x-forwarded-proto
https
content-length
4366
sec-ch-ua-platform
"Windows"
user-agent
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0
sec-ch-ua
"Not(A:Brand";v="8", "Chromium";v="144", "Microsoft Edge";v="144"
content-type
application/json
sec-ch-ua-mobile
?0
accept
*/*
origin
https://humtech-scorecard-v2.vercel.app
sec-fetch-site
cross-site
sec-fetch-mode
cors
sec-fetch-dest
empty

Output
To make sure expressions after this node work, return the input items that produced each output item. More info
 
1 item
headers
connection
upgrade
host
n8n.resg.uk
x-real-ip
86.164.36.212
x-forwarded-for
86.164.36.212
x-forwarded-proto
https
content-length
4366
sec-ch-ua-platform
"Windows"
user-agent
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0
sec-ch-ua
"Not(A:Brand";v="8", "Chromium";v="144", "Microsoft Edge";v="144"
content-type
application/json
sec-ch-ua-mobile
?0
accept
*/*
origin
https://humtech-scorecard-v2.vercel.app
sec-fetch-site
cross-site


Parameters
Settings
Docs 
Mode
Run Once for All Items
Language
JavaScript
JavaScript
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
    bandRange: BAND_META[k].range,

    // traffic light
    bandColor: BAND_META[k].color
  };
}

// ---------------------------
// 6) Return enriched JSON
// ---------------------------
return [
  {
    json: {
      ...$json,
      banding: {
        bandsMeta: BAND_META,
        overallBand
      },
      pillarInsights
    }
  }
];


## NODE: Radar chart URL

Logs
Back to canvas


Input

banding / qual mapping
1 item
headers
connection
upgrade
host
n8n.resg.uk
x-real-ip
86.164.36.212
x-forwarded-for
86.164.36.212
x-forwarded-proto
https
content-length
4366
sec-ch-ua-platform
"Windows"
user-agent
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0
sec-ch-ua
"Not(A:Brand";v="8", "Chromium";v="144", "Microsoft Edge";v="144"
content-type
application/json
sec-ch-ua-mobile
?0
accept
*/*
origin
https://humtech-scorecard-v2.vercel.app
sec-fetch-site
cross-site
sec-fetch-mode
cors
sec-fetch-dest
empty

Output
To make sure expressions after this node work, return the input items that produced each output item. More info
 
1 item
headers
connection
upgrade
host
n8n.resg.uk
x-real-ip
86.164.36.212
x-forwarded-for
86.164.36.212
x-forwarded-proto
https
content-length
4366
sec-ch-ua-platform
"Windows"
user-agent
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0
sec-ch-ua
"Not(A:Brand";v="8", "Chromium";v="144", "Microsoft Edge";v="144"
content-type
application/json
sec-ch-ua-mobile
?0
accept
*/*
origin
https://humtech-scorecard-v2.vercel.app
sec-fetch-site
cross-site


Parameters
Settings
Docs 
Mode
Run Once for All Items
Language
JavaScript
JavaScript
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
      },
      angleLines: {
        color: "rgba(25,48,80,0.38)",
        lineWidth: 1.6
      }
    }
  }
};

// bigger image for PDF clarity
const radarUrl =
  "https://quickchart.io/chart?width=1700&height=1250&devicePixelRatio=2&format=png&backgroundColor=white&c=" +
  encodeURIComponent(JSON.stringify(chartConfig));

return [{ json: { ...$json, radarUrl } }];

Type $ for a list of special vars/methods. Debug by using console.log() statements and viewing their output in the browser console.
 I wish this node would...


NODE: Build PDF HTML

Logs
Back to canvas


Input

Radar chart URL
1 item
headers
connection
upgrade
host
n8n.resg.uk
x-real-ip
86.164.36.212
x-forwarded-for
86.164.36.212
x-forwarded-proto
https
content-length
4366
sec-ch-ua-platform
"Windows"
user-agent
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0
sec-ch-ua
"Not(A:Brand";v="8", "Chromium";v="144", "Microsoft Edge";v="144"
content-type
application/json
sec-ch-ua-mobile
?0
accept
*/*
origin
https://humtech-scorecard-v2.vercel.app
sec-fetch-site
cross-site
sec-fetch-mode
cors
sec-fetch-dest
empty

Output
To make sure expressions after this node work, return the input items that produced each output item. More info
 
1 item
source
<!doctype html>\n<html lang="en">\n<head>\n <meta charset="utf-8" />\n <title>HumTech Assessment Report</title>\n <style>\n :root{\n --navy:#193050;\n --yellow:#D8B743;\n --blue:#3DB2DD;\n --green:#6BB790;\n --bg:#E1E4E9;\n --card:#ffffff;\n --muted: rgba(25,48,80,0.74);\n --muted2: rgba(25,48,80,0.60);\n --line: rgba(25,48,80,0.12);\n --shadow: 0 10px 28px rgba(15, 23, 42, 0.08);\n }\n\n *{ box-sizing:border-box; }\n body{\n margin:0;\n font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n color: var(-...


Parameters
Settings
Docs 
Mode
Run Once for All Items
Language
JavaScript
JavaScript
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469

    <!-- PAGE 2 -->

    <div class="card">
      <div class="section-title">What this means</div>
      <div class="muted">These summaries translate each pillar score into practical commercial impact.</div>

      <div class="qual-grid">
        ${pillarCardsHtml}
      </div>
    </div>

  </div>
</body>
</html>`;

return [{ json: { source: html } }];

Type $ for a list of special vars/methods. Debug by using console.log() statements and viewing their output in the browser console.
 I wish this node would...
